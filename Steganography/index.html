<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>Steganography</title>
        <link rel="icon" href="./Resources/js_icon.jpg" type="jpg">
    </head>
    <body style="background-color: rgb(44, 46, 54); color: whitesmoke; font-size: 24px;">
        
        <div>
            <p>Reader</p>
            <input type="file" id="source">
            <button onclick="window.read()">Read</button>
        </div>
        <hr>
        <div>
            <p>Downloader</p>
            <a id="download" style="color: cyan;">Download will go here</a>
            <button onclick="window.download()">Download</button>
        </div>
        <hr>
        <div>
            <p>Progress</p>
            <p id="progress"></p>
            <p>Sample</p>
            <p id="display" style="word-break: break-word; max-width: 95vw;"></p>
        </div>

        <script type="module">
            import { Reader } from "./Code/src/reader.js";
            import { URICompressor } from "./Code/src/compression.js";
            import { x2x8 } from "./Code/src/base2-base8.js";
            import { Provider } from "./Code/src/provider.js";
            window.reader = new Reader("source");
            window.downloader = new Provider("download");
            window.converter = new x2x8();

            window.read = async function()
            {
                //read the file as binary from the reader
                var file = await window.reader.readSingleAsBinary();
                var size1 = Math.floor(file.data.length/8);

                //compress the binary (also to binary)
                file.data = URICompressor.compress(file.data);
                var size2 = Math.floor(file.data.length/8);
                console.log("Compression reduced file from " + size1 + " bytes to " + size2 + " bytes (" + size2/size1 + ")");
                
                //convert from binary (base 2) to octal (base8)
                file.data = window.converter.to8(file.data);
                document.getElementById("display").innerHTML = JSON.stringify(file);
                window.payload = file;
            }

            window.download = async function()
            {
                //collect the compressed binary data from the window's payload
                var file = window.payload;
                
                //convert from octal (base 8) to binary (base 2)
                file.data = window.converter.to2(file.data);

                //decompress the binary (also to binary)
                file.data = URICompressor.decompress(file.data);

                document.getElementById("display").innerHTML = "";

                window.downloader.clear();
                var name = file.name;
                var type = file.type;
                var data = URICompressor.BinaryToU8(file.data);
                window.downloader.provide(name, type, data);
            }
            setInterval(function(){
                document.getElementById("progress").innerHTML = "Progress: " + String(window.converter.progress).substring(2,4) + "%";
            },1000);
        </script>

        <script>
            function navigateRoot()
            {
                window.location.href = "./index.html";
            }
            function proceed()
            {
                alert("program execution would now countine");
            }
        </script>

        <hr>
        <i style="color: whitesmoke;">This tool was developed by Brendan Rood in the spring of 2024</i>
    </body>
</html>
